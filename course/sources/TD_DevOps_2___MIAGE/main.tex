\documentclass{article}%
   \input{header}
    \begin{document}
    \noindent\begin{tabularx}{\textwidth}[t]{X>{\centering\arraybackslash}c>{\raggedleft\arraybackslash}X}
      \classe&{\Huge TP 2: Docker et Docker Compose} & \\
    \end{tabularx}

\section*{Prérequis}

Installer Docker sur la machine.
\begin{itemize}
    \item Sur Ubuntu
        \begin{verbatim}
        sudo apt install -y docker.io
        sudo apt install -y docker-compose-v2
        \end{verbatim}
    
    \item Sur MacOS, avec Brew:
        \begin{verbatim}
        brew install docker
        \end{verbatim}
        
    \item Sur Windows ? Utilisez une VM...
\end{itemize}

Télécharger Docker Desktop (\url{https://www.docker.com/products/docker-desktop/})

\section{Premier conteneur}

Après avoir démarré Docker Desktop, ouvrez un terminal pour exécuter les commandes du TP.

\begin{itemize}
    \item 
Lancez votre premier conteneur avec l’image officielle \texttt{hello-world} :
\begin{verbatim}
docker run hello-world
\end{verbatim}
Observez le message affiché et expliquez ce qui se passe.

\item
Listez les conteneurs existants avec \texttt{docker ps -a}.
\end{itemize}

\section{Explorer l'image Alpine}
\begin{enumerate}
    \item Téléchargez l’image Alpine :
    \begin{verbatim}
    docker pull alpine
    \end{verbatim}
    \item Lancez un conteneur interactif basé sur Alpine :
    \begin{verbatim}
    docker run -it alpine /bin/sh
    \end{verbatim}
    \item Explorez le système de fichiers (commande \texttt{ls}, \texttt{cat}, etc.).
    \item Essayez de trouver un noyau Linux dans le conteneur. Que remarquez-vous ?
\end{enumerate}

Note : vous pouvez quitter l'environnement interactif d'Alpine en utilisant \texttt{exit}.

\section{Manipulation d’images}
\begin{enumerate}
    \item Listez les images disponibles localement avec \texttt{docker images}
    \item Téléchargez l'image \texttt{busybox} avec la commande \texttt{docker pull busybox}
    \item Inspectez  cette nouvelle image avec \texttt{docker image inspect busybox}.
    \item Supprimez une image inutilisée avec \texttt{docker image rm busybox}
\end{enumerate}

\section{Construire une image avec un Dockerfile}
\begin{enumerate}
    \item Créez un fichier \texttt{Dockerfile} contenant les instructions suivantes :
    \begin{verbatim}
    FROM alpine:latest
    WORKDIR /app
    COPY hello.sh .
    RUN chmod +x hello.sh
    CMD ["./hello.sh"]
    \end{verbatim}
    \item Créez un script \texttt{hello.sh} qui affiche \texttt{"Hello Docker!"}.
    \item Construisez l’image :
    \begin{verbatim}
    docker build -t monapp:latest .
    \end{verbatim}
    \item Lancez l’image et vérifiez le résultat.
\end{enumerate}

\section{Bonnes pratiques}
\begin{enumerate}
    \item Modifiez votre Dockerfile pour installer \texttt{curl}, puis supprimez les fichiers
    temporaires afin de réduire la taille de l’image.
    \item Comparez la taille de l’image avant et après l’optimisation.
\end{enumerate}

\section{Déploiement avec Docker Compose}
\begin{enumerate}
    \item Créez un fichier \texttt{compose.yaml} décrivant deux services :
    \begin{itemize}
        \item \texttt{web} basé sur l’image \texttt{nginx:latest}, exposant le port 8080.
        \item \texttt{db} basé sur l’image \texttt{mariadb:latest}, avec un mot de passe
        administrateur défini par une variable d’environnement.
    \end{itemize}
    \item Lancez la pile avec :
    \begin{verbatim}
    docker-compose up -d
    \end{verbatim}
    \item Vérifiez que le serveur Nginx est accessible sur \texttt{http://localhost:8080}.
    \item Arrêtez et supprimez les conteneurs avec :
    \begin{verbatim}
    docker-compose down
    \end{verbatim}
\end{enumerate}

\end{document}
