\usepackage{graphicx}
%\usepackage{cite}
\usepackage{subcaption}
\usepackage{lmodern}
\usepackage{hyperref}
\usepackage{array}
\usepackage{multirow}
%\usepackage[table]{xcolor}
\usepackage{mathabx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{wrapfig}
\usepackage{fancyhdr}
\usepackage{url}
\usepackage{listings}
\usepackage{minted}
\usepackage{fontawesome}
\usepackage{tikz}
\usepackage{hyperref}
\usetikzlibrary{automata, positioning, matrix, fit}
\usetikzlibrary{arrows.meta,calc,decorations.markings,math}
\usetikzlibrary{positioning,shapes.misc}
\usetikzlibrary{shadows.blur}
\usetikzlibrary{decorations.pathreplacing, fit}
\usetikzlibrary{shapes,arrows}
\usepackage{flushend}
\usepackage{ifthen}
\newboolean{showtodos}

% ----------------------------------------
% COLORS
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{ashgrey}{rgb}{0.7, 0.75, 0.71}
\definecolor{battleshipgrey}{rgb}{0.52, 0.52, 0.51}
\definecolor{aliceblue}{rgb}{0.94, 0.97, 1.0}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{auburn}{rgb}{0.43, 0.21, 0.1}
\definecolor{babyblue}{rgb}{0.54, 0.81, 0.94}
\definecolor{amaranth}{rgb}{0.9, 0.17, 0.31}
\definecolor{bleudefrance}{rgb}{0.19, 0.55, 0.93}
\definecolor{atomictangerine}{rgb}{1.0, 0.6, 0.4}
\definecolor{beaublue}{rgb}{0.74, 0.83, 0.9}
\definecolor{dkviolet}{rgb}{0.9, 0.17, 0.31}
\definecolor{dkgreen}{rgb}{0.0, 0.42, 0.24}
\definecolor{ltblue}{rgb}{0.0, 0.75, 1.0}
\definecolor{dkblue}{rgb}{0.2, 0.2, 0.6}
\definecolor{dkred}{rgb}{0.8, 0.0, 0.0}
\definecolor{byzantine}{rgb}{0.74, 0.2, 0.64}
% ----------------------------------------



\usepackage[textwidth=17mm]{todonotes}
\newcommand{\instructions}[1]{
	\todo[color=black!20,inline,size=\small]{#1}
}
\newcommand{\customtodo}[4]{
\ifthenelse{\boolean{showtodos}} { 
	\todo[color=#2,inline,size=\small]{
		\ifx&#3&
		\textbf{#1} #4
		\else
		\textbf{#1$\Rightarrow$#3} #4
		\fi
	}
 } 
}{}

\newcommand{\jolan}[2][]{\customtodo{Jolan}{pink!40}{#1}{#2}}
\newcommand{\antoine}[2][]{\customtodo{Antoine}{red!40}{#1}{#2}}
\newcommand{\helene}[2][]{\customtodo{Helene}{orange!40}{#1}{#2}}
\newcommand{\issam}[2][]{\customtodo{Issam}{green!40}{#1}{#2}}
\newcommand{\charles}[2][]{\customtodo{Charles}{blue!40}{#1}{#2}}

\newcommand{\tmp}[1][]{\customtodo{To remove}{gray}{#1}}

\usepackage{xspace}
\newcommand{\ie}[0]{{\em i.e.},\xspace}
\newcommand{\vs}[0]{{\em vs.}\xspace}
\newcommand{\eg}[0]{{\em e.g.},\xspace}
\newcommand{\etal}[0]{{\em et al.}\xspace}
\newcommand{\wrt}[0]{{\em w.r.t.}\xspace}
\newcommand{\aka}[0]{{\em a.k.a.}\xspace}
\newcommand{\via}[0]{{\em via}\xspace}

% ----------------------------------------

\lstdefinestyle{goalstyle}{
  basicstyle=\scriptsize\itshape,
  xleftmargin=1em,
  literate={::=}{$::=$}{2},
  keywords={behaviors,ports,components,forall,component,behavior,port,status}
}

\lstdefinelanguage{MiniZinc}{
numberstyle=\tiny\color{gray},
% Anything betweeen $ becomes LaTeX math mode
mathescape=true,
% Comments may or not include Latex commands
texcl=false,
% Vernacular commands
morekeywords=[1]{ann, annotation, any, array, assert,
        bool,
        constraint,
        else, elseif, endif, enum, exists,
        float, forall, function,
        if, in, include, int,
        list,
        minimize, maximize,
        of, op, output,
        par, predicate,
        record,
        set, solve, string,
        test, then, tuple, type,
        var,
        where,
        %% MiniZinc functions
        %%
        abort, abs, acosh, array_intersect, array_union,
        array1d, array2d, array3d, array4d, array5d, array6d, asin, assert, atan,
        bool2int,
        card, ceil, combinator, concat, cos, cosh,
        dom, dom_array, dom_size, dominance,
        exp,
        fix, floor,
        index_set, index_set_1of2, index_set_2of2, index_set_1of3, index_set_2of3, index_set_3of3,
        int2float, is_fixed,Yaml
        join,
        lb, lb_array, length, let, ln, log, log2, log10,
        min, max,
        pow, product,
        round,
        set2array, show, show_int, show_float, sin, sinh, sqrt, sum,
        tan, tanh, trace,
        ub, and ub_array,
        %% Search keywords
        bool_search, int_search, seq_search, priority_search,
        %% MiniSearch keywords
        minisearch, search, while, repeat, next, commit, print, post, sol, scope, time_limit, break, fail},
numbers=left,
% Gallina
morekeywords=[2]{Array},
% Spaces are not displayed as a special character
showstringspaces=false,
% String delimiters
morestring=[b]",
morestring=[d]',
% Size of tabulations
tabsize=2,
% Enables ASCII chars 128 to 255
extendedchars=false,
% Case sensitivity
sensitive=true,
% Automatic breaking of long lines
breaklines=false,
% Default style fors listings
basicstyle=\footnotesize,
% Position of captions is bottom
captionpos=b,
% flexible columns
basewidth={2em, 0.5em},
columns=[l]flexible,
% Style for (listings') identifiers
identifierstyle={\ttfamily\color{black}},
% Style for declaration keywords
keywordstyle=[1]{\ttfamily\bfseries\color{dkviolet}},
% Style for gallina keywords
keywordstyle=[2]{\ttfamily\bfseries\color{dkgreen}},
% Style for strings
stringstyle=\ttfamily,
% Style for comments
commentstyle={\ttfamily\itshape\color{dkgreen}},
%moredelim=**[is][\ttfamily\color{red}]{/&}{&/},
literate=
  {forall}{{\color{dkgreen}{$\forall$}}}1
{exists}{{$\exists$}}1
{<-}{{$\leftarrow$}}1
{=>}{{$\Rightarrow$}}1
%{==}{{\code{==}}}1
%{==>}{{\code{==>}}}1
%    {:>}{{\code{:>}}}1
{->}{{$\rightarrow$}}1
{<-->}{{$\longleftrightarrow$}}1
{<->}{{$\leftrightarrow$}}1
{<==}{{$\leq$}}1
{\#}{{$^\star$}}1
{\\o}{{$\circ$}}1
%    {\@}{{$\cdot$}}1 
{\/\\}{{$\wedge$}}1
{\\\/}{{$\vee$}}1
%{++}{{\code{++}}}1
{~}{{\ }}1
{\@\@}{{$@$}}1
{\\mapsto}{{$\mapsto$}}1
{\\hline}{{\rule{\linewidth}{0.5pt}}}1
%
}[keywords,comments,strings]
\lstdefinestyle{mznstyle}{
  language=MiniZinc,
}
% ----------------------------------------
\lstdefinelanguage{MyPython}{
morekeywords=[1]{def, if, while, return, not},
morekeywords=[5]{get_messages, infer_constraints, plan_inference, infer_messages, bhv_inference, send_messages, allAcked, send_ack, ack, global_ack},
keywordstyle=[5]{\ttfamily\bfseries\color{purple}},
tabsize=2,
numbers=left,
numberstyle=\tiny\color{gray},
breaklines=true,
basicstyle=\footnotesize,
% literate= 
% {act_c}{{$act_c$}}1
% {Gbhv}{{$\Gamma bhv$}}1
% {Gfinal}{{$\Gamma final$}}1,
% {Gbhv_c}{{$\Gamma bhv_{c}$}}1
% {Gport_c}{{$\Gamma port_{c}$}}1
% {Gfinal_c}{{$\Gamma final_{c}$}}1
}
\lstdefinestyle{pythonstyle}{language=MyPython}
\lstMakeShortInline[language=MyPython]"

\newfloat{Model}{t}{lom}
\newcommand{\constraint}[1]{\textnormal{\textsc{#1}}}
\newcommand{\Regular}{\constraint{Regular}}
\newcommand{\CostRegular}{\constraint{CostRegular}}
\newcommand{\Count}{\constraint{Count}}
\newcommand{\Element}{\constraint{Element}}
\newcommand{\Sum}{\constraint{Sum}}

%------------------------------------------------------
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{mystyle}{
    commentstyle=\color{codegreen},
    keywordstyle=\color{purple},
    tabsize=2,
    numbers=left,
    numberstyle=\tiny\color{gray},
    stringstyle=\color{codepurple},
    breaklines=true,
    basicstyle=\tiny
}


\definecolor{keywords}{RGB}{255,0,90}
\definecolor{comments}{RGB}{0,0,113}
\definecolor{red}{RGB}{160,0,0}
\definecolor{green}{RGB}{0,150,0}
\definecolor{backcolour}{rgb}{0.95,0.95,0.95}
\DeclareCaptionFont{white}{\color{white}}
\DeclareCaptionFont{gray}{\color{gray}}
\DeclareCaptionFormat{listing}{\colorbox{backcolour}{\parbox{\linewidth}{#1#2#3}}}
\captionsetup[lstlisting]{format=listing}%,labelfont=white,textfont=white}
\lstdefinestyle{mystyle}{
    tabsize=2,
    numberstyle=\tiny\color{gray},
    breaklines=true,
    numbers=left,
    backgroundcolor=\color{white},
    numbersep=5pt,
    keywordstyle=\color{keywords},
    commentstyle=\color{comments},
    stringstyle=\color{blue},
    showstringspaces=false,
    identifierstyle=\color{green},
    basicstyle=\scriptsize\ttfamily,
    numberstyle=\tiny\color{gray},
}

\lstdefinestyle{mysmallstyle}{
    tabsize=2,
    numberstyle=\tiny\color{gray},
    breaklines=true,
    numbers=left,
    backgroundcolor=\color{white},
    numbersep=5pt,
    keywordstyle=\color{keywords},
    commentstyle=\color{comments},
    stringstyle=\color{blue},
    showstringspaces=false,
    identifierstyle=\color{green},
    basicstyle=\scriptsize\ttfamily,
    numberstyle=\tiny\color{gray},
}

\lstdefinestyle{yaml}{
     basicstyle=\color{black}\scriptsize,
     keywords =[1]{behaviors, components, connections},
    keywordstyle=[1]{\color{blue}\scriptsize}, 
     rulecolor=\color{black},
     string=[s]{'}{'},
     stringstyle=\color{blue},
     comment=[l]{:},
     commentstyle=\color{black},
     morecomment=[l]{-}
 }


% \usetikzlibrary{positioning, arrows.meta, decorations.pathreplacing, fit}
% \pgfarrowsdeclare{lollipop}{lollipop}{
%     \pgfsetlinewidth{0.7pt}
%     \pgfarrowsleftextend{0pt}
%     \pgfarrowsrightextend{2pt}
% }{
%     \pgfpathcircle{\pgfpoint{0pt}{0pt}}{2pt}
%     \pgfusepathqfillstroke
% }
% \pgfarrowsdeclare{socket}{socket}{
%     \pgfarrowsleftextend{2pt}
%     \pgfarrowsrightextend{2pt}
% }{
%     \pgfsetlinewidth{0.7pt}
%     \pgfpathmoveto{\pgfqpoint{3pt}{-3pt}}
%     \pgfpatharc{270}{90}{3pt}
%     \pgfusepathqstroke
% }

% % Define styles for lollipop and socket arrows
% \tikzset{
%   lollipop/.style={
%     -{lollipop}
%   },
%   socket/.style={
%     -{socket}
%   }
% }





% Define a new arrow tip for the lollipop (filled circle)
\pgfarrowsdeclare{lollipop}{lollipop}{
    \pgfsetlinewidth{0.7pt}
    \pgfarrowsleftextend{0pt}
    \pgfarrowsrightextend{2pt}
}{
    \pgfpathcircle{\pgfpoint{0pt}{0pt}}{2pt}
    \pgfusepathqfillstroke
}

% Define a new arrow tip for the socket (reversed C)
\pgfarrowsdeclare{socket}{socket}{
    \pgfarrowsleftextend{2pt}
    \pgfarrowsrightextend{2pt}
}{
    \pgfsetlinewidth{0.7pt}
    \pgfpathmoveto{\pgfqpoint{3pt}{-3pt}}
    \pgfpatharc{270}{90}{3pt}
    \pgfusepathqstroke
}

% Define styles for lollipop and socket arrows
\tikzset{
  lollipop/.style={
    -{lollipop}
  },
  socket/.style={
    -{socket}
  }
}

\newcommand{\simpleprovideuse}[3][1cm]{%
    \path (#2) -- (#3) coordinate[pos=0.5] (mid#2#3);
    \draw[-{lollipop}] (#2) -- (mid#2#3);
    \draw[-{socket}] (#3) -- (mid#2#3);
}

\newcommand{\provideuse}[3][1cm]{
    % Usage :
    %   \provideuse{src}{target}
    % Example:
    %   \node[draw, circle] (A) {A};
    %   \node[draw, circle] (B) {B};
    %   \provideuse{A}{B}
    \path (#2) -- (#3) coordinate[pos=0.5] (mid#2#3);
    \path (#2) -- (mid#2#3) coordinate[pos=0.5] (q1#2#3);
    \path (mid#2#3) -- (#3) coordinate[pos=0.5] (q3#2#3);
    \draw[-{lollipop}] (#2) -- (q1#2#3);
    \draw[-{lollipop}] (mid#2#3) -- (q3#2#3);
    \draw[-{socket}] (#3) -- (q3#2#3);
    \draw[-{socket}] (q3#2#3) -- (q1#2#3);
}

\newcommand{\provideusetwolabels}[5][1cm]{%
    % Usage :
    %   \provideusetwolabels{src}{target}
    % Example:
    %   \node[draw, circle] (A) {A};
    %   \node[draw, circle] (B) {B};
    %   \provideusetwolabels{A}{B}{provide}{use}
    \path (#2) -- (#3) coordinate[pos=0.5] (mid#2#3);
    \path (#2) -- (mid#2#3) coordinate[pos=0.5] (q1#2#3);
    \path (mid#2#3) -- (#3) coordinate[pos=0.5] (q3#2#3);
    \draw[-{lollipop}] (#2) --  node[midway, above, xshift=0.08cm] {\tiny #4} (q1#2#3);
    \draw[-{lollipop}] (mid#2#3) -- (q3#2#3);
    \draw[-{socket}] (#3) -- node[midway, below, xshift=-0.4cm] { \tiny #5} (q3#2#3);
    \draw[-{socket}] (q3#2#3) -- (q1#2#3);
}

\newcommand{\provideusesinglelabel}[4][1cm]{%
    % Usage :
    %   \provideusesinglelabel{src}{target}
    % Example:
    %   \node[draw, circle] (A) {A};
    %   \node[draw, circle] (B) {B};
    %   \provideusesinglelabel{A}{B}{relation}
    \path (#2) -- (#3) coordinate[pos=0.5] (mid#2#3);
    \path (#2) -- (mid#2#3) coordinate[pos=0.5] (q1#2#3);
    \path (mid#2#3) -- (#3) coordinate[pos=0.5] (q3#2#3);
    \draw[-{lollipop}] (#2) -- (q1#2#3);
    \draw[-{lollipop}] (mid#2#3) -- (q3#2#3);
    \draw[-{socket}] (#3) -- (q3#2#3);
    \draw[-{socket}] (q3#2#3)  -- node[midway, above] {\scriptsize #4} (q1#2#3);
}

\usepackage{pifont,utfsym}
\newcommand{\cmark}{\ding{51}}
\newcommand{\xmark}{\ding{55}}
\newcommand{\okmark}{\textbf{\color{green}\faCheck}}
\newcommand{\komark}{\textbf{\color{red}\faTimes}}
\newcommand{\midmark}{\textbf{\color{orange}$\sim$}}
\newcommand{\OKmark}{\okmark~}
\newcommand{\OKOKmark}{\okmark\okmark~}
\newcommand{\KOmark}{\komark~}
\newcommand{\MIDmark}{\midmark~}